---
title: "Internet Movie Database report - Relatório do Banco de Dados de Filmes da Internet"
description: |
  This is the final report of the Data Science R  II course presented to curso-r to obtain the certification. Este é o relatório final do   cursor R para Ciência de Dados II apresntado para curso-r para obtenção do certificado.
author: Tainá Carreira da Rocha
date: 2021-12-27
output: rmarkdown::github_document
---

This is the final report of the Data Science R  II course presented to curso-r to obtain the certification. The course was promoted by [curso-r](https://curso-r.com/), a Brazilian company specialized in teaching Data Science using the R language.  The [course](https://curso-r.github.io/202111-r4ds-2/) happened in November 2021 and was ministered by Caio Castro and Amanda Amorim |<br/>
<div style="text-align: justify"> Este é o relatório final do   cursor R para Ciência de Dados II apresentado para curso-r para obtenção do certificado.O curso foi promovido pela curso-r, empresa brasileira especializada no ensino de Ciência de Dados na linguagem R. O curso aconteceu em Novembro de 2021 e foi ministrado por Caio Leite e Amanda Amorim. 


### The IMDB dataset | A base de dados IMDB 

Internet Movie Database (IMDB) is an online database of information related to films, television series, home videos, video games, and streaming content online – including cast, production crew and personal biographies, plot summaries, trivia, ratings, and fan and critical reviews.|<br/>
IMDB um banco de dados online de informações relacionadas a filmes, séries de televisão, vídeos caseiros, videogames e streaming de conteúdo online - incluindo elenco, equipe de produção e biografias pessoais, resumos de enredo, curiosidades, classificações e análises de fãs e críticas
</div>

The report respond follow questions: | Este relatório responde as seguintes perguntas :

1. Which month of the year has the most movies? And what day of the year?| Qual o mês do ano com o maior número de filmes? E o dia do ano?

2. Which top 5 countries with most films in the dataset ?| Qual o top 5 países com mais filmes na base?

3. List all currency in `orcamento` and  `receita` columns of `imdb_completa` dataset.| Liste todas as moedas que aparecem nas colunas `orcamento` e `receita` da base `imdb_completa`.

4. Considerando apenas orçamentos e receitas em dólar ($), qual o gênero com maior lucro? E com maior nota média?

5. Dentre os filmes na base `imdb_completa`, escolha o seu favorito. Então faça os itens a seguir:

a) Quem dirigiu o filme? Faça uma ficha dessa pessoa: idade (hoje em dia ou data de falecimento), onde nasceu, quantos filmes já dirigiu, qual o lucro médio dos filmes que dirigiu (considerando apenas valores em dólar) e outras informações que achar interessante (base `imdb_pessoas`).

b) Qual a posição desse filme no ranking de notas do IMDB? E no ranking de lucro (considerando apenas valores em dólar)?

c) Em que dia esse filme foi lançado? E dia da semana? Algum outro filme foi lançado no mesmo dia? Quantos anos você tinha nesse dia?

d) Faça um gráfico representando a distribuição da nota atribuída a esse filme por idade (base `imdb_avaliacoes`).

```{r, eval = FALSE, echo=FALSE}
## To access the complete IMDB dataset and other datasets to response de questions, install basesCursoR package of curso-r. 
remotes::install_github("curso-r/basesCursoR")

## Get the IMDB complete dataset 
imdb <- basesCursoR::pegar_base("imdb_completa")

##  Get IMDB People dataset
imdb_pessoas <- basesCursoR::pegar_base("imdb_pessoas")

## Get IMDB assessments
imdb_avaliacoes <- basesCursoR::pegar_base("imdb_avaliacoes")

```

Load the libraries. If it's not installed use command _install.packages("pckg name")_ 

```{r, eval = FALSE}
library(dplyr)
library(forcats)
library(lubridate)
library(knitr)
library(tibble)
library(tidyverse)
library(stringr)
```


1. Which month of the year has the most movies? And what day of the year?| Qual o mês do ano com o maior número de filmes? E o dia do ano?

```{r, eval = FALSE}
## Month

month_movies <- imdb |>  
  mutate(data_lancamento_2 = as.Date(ymd(data_lancamento))) |> # Convert from character to calendar date
  mutate(month = month(data_lancamento_2)) |> # Get/set months component of a date-time
  filter(across (c(ano, month), ~ !is.na(.))) |>  # Remove NA in ano, month columns using forcats
  mutate(year_month = paste(ano, month, sep = "/")) |> # Union of year and Month in column 
  group_by(year_month) |> # Take Column year_month and...
  mutate(count_movies = n_distinct(titulo)) |>  # Count unique values
  ungroup() |> 
  nest_by(year_month, count_movies) |> 
  arrange(desc(count_movies)) |>
  head(1)
month_movies  

## Day

day_movies <- imdb |>  
  mutate(data_lancamento_2 = as.Date(ymd(data_lancamento))) |>   
  mutate(month = month(data_lancamento_2)) |>  
  mutate(day = day(data_lancamento_2)) |>  
  filter(across(c(day, month, ano), ~ !is.na(.))) |>  
  mutate(year_month_day = paste(ano, month, day, sep = "/")) |>  
  group_by(year_month_day) |>  
  mutate(count_movies = n_distinct(titulo)) |>  
  ungroup() |> 
  nest_by(year_month_day, count_movies) |>  
  arrange(desc(count_movies)) |>  
  head(1)
  
day_movies
```

2. Which top 5 countries with most films in the dataset ?| Qual o top 5 países com mais filmes na base?

```{r, eval = FALSE}
top_5 <- imdb |> 
  filter(!is.na(pais))  |> 
  group_by(pais) |> 
  count(pais, sort = TRUE) |> 
head(5)
top_5

```
3. List all currency in `orcamento` and  `receita` columns of `imdb_completa` dataset.| Liste todas as moedas que aparecem nas colunas `orcamento` e `receita` da base `imdb_completa`.


```{r}
currency <- imdb |> 
  filter(across(c(orcamento, receita), ~!is.na(.)))  |> 
  summarise(unique(across(
    .cols = c(orcamento, receita),
    .fns = ~ str_remove((.x), pattern = '[0-9]+')))) 
currency
```

4. Considerando apenas orçamentos e receitas em dólar ($), qual o gênero com maior lucro? E com maior nota média?

Maior Lucro por Gênero
```{r}
gen_dolar <- imdb |> 
filter(across(c(orcamento, receita), ~!is.na(.)))  |>
 mutate(across(starts_with(c("orcamento", "receita")), ~gsub("\\$", "", .))) |> 
 mutate(across(.cols = c(orcamento, receita), .fns = ~ as.numeric(.x))) |> 
 mutate(lucro = c(receita - orcamento)) |> 
 filter(across(c(lucro, genero), ~!is.na(.))) |> 
 mutate(genero = str_split(genero, ", ")) |>  
 unnest(genero) |> 
 nest_by(genero, lucro) |> 
 arrange(desc(lucro)) |> 
 head(1)
  
gen_dolar
  
```


Título
```{r}
gen_mean <- imdb |>  
  left_join(imdb_avaliacoes, by = "id_filme", copy = TRUE) |> 
  filter(across(c(genero, nota_media), ~!is.na(.))) |>  
  mutate(genero = str_split(genero, ", ")) |>  
  unnest(genero) |>  
  nest_by(genero, nota_media) |>  
  arrange(desc(nota_media)) |>  
  head(1) 
gen_mean
```


5. Dentre os filmes na base `imdb_completa`, escolha o seu favorito. Então faça os itens a seguir:

a) Quem dirigiu o filme? Faça uma ficha dessa pessoa: idade (hoje em dia ou data de falecimento), onde nasceu, quantos filmes já dirigiu, qual o lucro médio dos filmes que dirigiu (considerando apenas valores em dólar) e outras informações que achar interessante (base `imdb_pessoas`).

Direction
```{r}
esdto_director <- imdb |>  
  filter(str_detect(id_filme, pattern = "tt1305806$")) |>  
  select("Diretor Name's"= direcao)

esdto_director

```


General Infos

```{r}
general_infos <- imdb_pessoas |> 
 filter(str_detect(nome, pattern = "Juan José Campanella")) |> 
  #filter(str_detect(titulo, pattern = "tt1305806$", negate = TRUE)) %>% 
  #summarise(n_filmes = n_distinct(titulo))
  mutate(across(.cols = data_nascimento, .fns = ~ as.Date(ymd(.)))) |> 
  mutate(idade = Sys.Date() - data_nascimento) |> 
  mutate(across(.cols = idade, .fns = ~ as.numeric(.x))) |> 
  mutate(idade = idade/365) |> 
  select(idade, local_nascimento, local_falecimento, data_nascimento, data_falecimento)
  
  general_infos

```

N filmes dirigidos 


```{r}

juan_all_movies  <- imdb |> 
  left_join(imdb_avaliacoes, by = "id_filme", copy = TRUE) |>
  filter(str_detect(direcao, pattern = "Juan José Campanella")) |> 
  filter(str_detect(id_filme, pattern = "tt1305806$", negate = TRUE)) |>  
  summarise(n_filmes = n_distinct(id_filme))

  juan_all_movies  
  
```

Lucros médios dos filmes dirigidos 

```{r}
lucro_medio <- imdb_completa %>% 
  filter(str_detect(direcao, pattern = "Milos Forman")) %>% 
  filter(across(c(receita, orcamento), ~!is.na(.), str_detect((.x), pattern = "^.[[:blank:][:digit:]]"))) %>% 
  mutate(across(
    .cols = c(orcamento, receita),
    .fns = ~ (str_extract((.x), pattern = ".[[:digit:]]+!*")))) %>% 
  mutate(across(
    .cols = c(orcamento, receita),
    .fns = ~ as.numeric(.x))) %>% 
  mutate(lucro = receita - orcamento) %>% 
  summarise(lucro_medio = mean(lucro))

```


b) Qual a posição desse filme no ranking de notas do IMDB? E no ranking de lucro (considerando apenas valores em dólar)?

Grade Ranking 
```{r}
ranking_grade <- imdb |>  
  left_join(imdb_avaliacoes, by = "id_filme", copy = TRUE) |>
  group_by(nota_media) |> 
  arrange((desc(nota_media))) |> 
  rowid_to_column(var = "Ranking_number") |> 
  filter(str_detect(id_filme, pattern = "tt1305806$"))
 
ranking_grade
```


Lucro Ranking 

```{r}
ranking_lucro <-imdb |> 
 filter(across(c(orcamento, receita), ~!is.na(.)))  |>
 mutate(across(starts_with(c("orcamento", "receita")), ~gsub("\\$", "", .))) |> 
 mutate(across(.cols = c(orcamento, receita), .fns = ~ as.numeric(.x))) |> 
 mutate(lucro = c(receita - orcamento)) |> 
 filter(across(c(lucro, genero), ~!is.na(.))) |> 
 group_by(lucro) |> 
  arrange(desc(lucro)) |> 
  rowid_to_column(var = "Ranking_Lucro") |> 
  filter(str_detect(id_filme, pattern = "tt1305806$"))

ranking_lucro
```



c) Em que dia esse filme foi lançado? E dia da semana? Algum outro filme foi lançado no mesmo dia? Quantos anos você tinha nesse dia?

```{r}

```

d) Faça um gráfico representando a distribuição da nota atribuída a esse filme por idade (base `imdb_avaliacoes`).

```{r}

```

